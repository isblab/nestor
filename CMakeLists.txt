# Autogenerated by tools/build/setup_cmake.py
# from tools/build/cmake_templates/Module.cmake
# Do not edit - any changes will be lost!

project(IMP.nestor)



if(DEFINED IMP_nestor_IS_CUDA OR DEFINED IMP_IS_CUDA)
  set(CUDA_DEFINES ":IMP_NESTOR_CUDA_LIB")
else()
  set(CUDA_DEFINES "")
endif()

imp_get_process_exit_code("Setting up module nestor" status ${CMAKE_BINARY_DIR}
                          COMMAND ${PYTHON_EXECUTABLE}
                          ${CMAKE_SOURCE_DIR}/tools/build/setup_module.py
                           --name=nestor
                          --datapath=${IMP_DATAPATH}
                          --defines=${IMP_nestor_CONFIG}:${CUDA_DEFINES}
                          --source=${CMAKE_SOURCE_DIR}
                          )

if(${status} EQUAL 0)
  imp_execute_process("setup_swig_wrappers nestor" ${CMAKE_BINARY_DIR}
    COMMAND ${PYTHON_EXECUTABLE} ${CMAKE_SOURCE_DIR}/tools/build/setup_swig_wrappers.py
     --module=nestor
    --datapath=${IMP_DATAPATH}
    --source=${CMAKE_SOURCE_DIR})

  # for warning control
  add_definitions(-DIMPNESTOR_COMPILATION)

  if(0 EQUAL 0)
    set(allh_command  "${PYTHON_EXECUTABLE}" "${CMAKE_SOURCE_DIR}/tools/dev_tools/make_all_header.py" "${CMAKE_BINARY_DIR}/include/IMP/nestor.h" "IMP/nestor" "${PROJECT_SOURCE_DIR}/include/" ${IMP_nestor_EXTRA_HEADERS})
    # for swig
    imp_execute_process("IMP.nestor making all header" ${PROJECT_BINARY_DIR}
                        COMMAND ${allh_command})

    add_custom_target(IMP.nestor-all-header
      COMMAND ${allh_command}
      DEPENDS "${CMAKE_SOURCE_DIR}/tools/dev_tools/make_all_header.py")
    set_property(TARGET "IMP.nestor-all-header" PROPERTY FOLDER "IMP.nestor")
    list(APPEND IMP_nestor_LIBRARY_EXTRA_DEPENDENCIES IMP.nestor-all-header)
  endif()

  
  if(IMP_DOXYGEN_FOUND)
    # documentation
    file(GLOB headers ${CMAKE_BINARY_DIR}/include/IMP/nestor/*.h)
    file(GLOB docs ${CMAKE_SOURCE_DIR}/modules/nestor/doc/*.dox
      ${CMAKE_SOURCE_DIR}/modules/nestor/doc/*.md)
    file(GLOB examples ${CMAKE_BINARY_DIR}/doc/examples/nestor/*.py
      ${CMAKE_BINARY_DIR}/doc/examples/nestor/*.cpp)

    if(NOT IMP_STATIC)
      set(IMP_nestor_TAG_DEPENDS "${IMP.nestor-python}")
    endif()

    add_custom_command(OUTPUT ${CMAKE_BINARY_DIR}/doxygen/nestor/tags ${CMAKE_BINARY_DIR}/doxygen/nestor/xml/index.xml
      COMMAND mkdir -p ${CMAKE_BINARY_DIR}/doc/html
      COMMAND ln -s -f ../../include
      COMMAND ln -s -f ../../doc/examples
      COMMAND ln -s -f ../../lib
      COMMAND ${IMP_DOXYGEN_EXECUTABLE} ../../doxygen/nestor/Doxyfile 2>&1 /dev/null
      COMMAND ${PYTHON_EXECUTABLE} ${CMAKE_SOURCE_DIR}/tools/build/doxygen_patch_tags.py --module=nestor --file=../../doxygen/nestor/tags
      COMMAND ${PYTHON_EXECUTABLE} ${CMAKE_SOURCE_DIR}/tools/build/doxygen_show_warnings.py --warn=../../doxygen/nestor/warnings.txt
      COMMAND ${PYTHON_EXECUTABLE} ${CMAKE_SOURCE_DIR}/tools/build/doxygen_spell_check.py xml ${CMAKE_SOURCE_DIR}/modules/nestor/test/standards_exceptions
      DEPENDS ${IMP_kernel_DOC}
${IMP_cgal_DOC}
${IMP_algebra_DOC}
${IMP_display_DOC}
${IMP_score_functor_DOC}
${IMP_core_DOC}
${IMP_container_DOC} ${headers} ${docs} ${examples} ${CMAKE_SOURCE_DIR}/modules/nestor/README.md ${IMP_nestor_TAG_DEPENDS}
      WORKING_DIRECTORY ${CMAKE_BINARY_DIR}/doxygen/nestor/
      COMMENT "Running doxygen on nestor")

    add_custom_target("IMP.nestor-doc" ALL DEPENDS ${CMAKE_BINARY_DIR}/doxygen/nestor/tags)
    set_property(TARGET "IMP.nestor-doc" PROPERTY FOLDER "IMP.nestor")
    set(IMP_nestor_DOC "IMP.nestor-doc" CACHE INTERNAL "" FORCE)

    if(NOT IMP_STATIC)
      list(APPEND IMP_DOC_DEPENDS "${IMP.nestor-python}")
    endif()
    list(REMOVE_DUPLICATES IMP_DOC_DEPENDS)
    set(IMP_DOC_DEPENDS ${IMP_DOC_DEPENDS} CACHE INTERNAL "" FORCE)
  else()
    set(IMP_nestor_DOC "" CACHE INTERNAL "" FORCE)
  endif(IMP_DOXYGEN_FOUND)

  if(0 EQUAL 0)
    list(APPEND imp_nestor_libs ${IMP_kernel_LIBRARY};${IMP_cgal_LIBRARY};${IMP_algebra_LIBRARY};${IMP_display_LIBRARY};${IMP_score_functor_LIBRARY};${IMP_core_LIBRARY};${IMP_container_LIBRARY})
    list(APPEND imp_nestor_libs ${BOOST.FILESYSTEM_LIBRARIES};${BOOST.PROGRAMOPTIONS_LIBRARIES};${BOOST.SYSTEM_LIBRARIES};${GPERFTOOLS_LIBRARIES};${TCMALLOC_HEAPPROFILER_LIBRARIES};${TCMALLOC_HEAPCHECKER_LIBRARIES};${BOOST.RANDOM_LIBRARIES};${NUMPY_LIBRARIES};${CGAL_LIBRARIES};${ANN_LIBRARIES};${HDF5_LIBRARIES};${PYTHON-IHM_LIBRARIES};${ROBIN_MAP_LIBRARIES};${GOOGLE_DENSE_HASH_MAP_LIBRARIES})
    list(REMOVE_DUPLICATES imp_nestor_libs)

    add_custom_command(
	OUTPUT ${CMAKE_BINARY_DIR}/lib/IMP/nestor/_version_check.py
               ${CMAKE_BINARY_DIR}/src/nestor_config.cpp
        COMMAND ${PYTHON_EXECUTABLE} ${CMAKE_SOURCE_DIR}/tools/build/make_module_version.py
	        --name=nestor --datapath=${IMP_DATAPATH}
		--source=${CMAKE_SOURCE_DIR}
        DEPENDS IMP-version
        WORKING_DIRECTORY ${CMAKE_BINARY_DIR}/
        COMMENT "Building module version info")

    add_custom_target("IMP.nestor-version" ALL DEPENDS
                      ${CMAKE_BINARY_DIR}/lib/IMP/nestor/_version_check.py
                      ${CMAKE_BINARY_DIR}/src/nestor_config.cpp)
    set_property(TARGET "IMP.nestor-version" PROPERTY FOLDER "IMP.nestor")
    install(FILES "${CMAKE_BINARY_DIR}/lib/IMP/nestor/_version_check.py"
	    DESTINATION "${CMAKE_INSTALL_PYTHONDIR}/IMP/nestor/")
   endif()

  add_subdirectory(${CMAKE_SOURCE_DIR}/modules/nestor/src)
add_subdirectory(${CMAKE_SOURCE_DIR}/modules/nestor/test)
add_subdirectory(${CMAKE_SOURCE_DIR}/modules/nestor/examples)
add_subdirectory(${CMAKE_SOURCE_DIR}/modules/nestor/benchmark)
add_subdirectory(${CMAKE_SOURCE_DIR}/modules/nestor/bin)
add_subdirectory(${CMAKE_SOURCE_DIR}/modules/nestor/utility)
  set(IMP_nestor "IMP.nestor" CACHE INTERNAL "" FORCE)
else()

  # make sure it is empty
  set(IMP_nestor_DOC "" CACHE INTERNAL "" FORCE)
  set(IMP_nestor_PYTHON "" CACHE INTERNAL "" FORCE)
  set(IMP_nestor "" CACHE INTERNAL "" FORCE)

  if(${status} EQUAL 1)
    message(STATUS "Module IMP.nestor disabled")
  else()
    message(FATAL_ERROR "setup_module returned ${status}")
  endif()
  set(IMP_nestor_LIBRARY CACHE INTERNAL "" FORCE)
endif()
